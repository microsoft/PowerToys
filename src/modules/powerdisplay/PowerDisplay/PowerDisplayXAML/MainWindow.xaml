<winuiex:WindowEx
    x:Class="PowerDisplay.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animatedVisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:local="using:PowerDisplay"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:vm="using:PowerDisplay.ViewModels"
    xmlns:winuiex="using:WinUIEx"
    MinWidth="0"
    MinHeight="0"
    IsAlwaysOnTop="True"
    IsMaximizable="False"
    IsMinimizable="False"
    IsResizable="False"
    IsShownInSwitchers="False"
    IsTitleBarVisible="False">
    <winuiex:WindowEx.SystemBackdrop>
        <DesktopAcrylicBackdrop />
    </winuiex:WindowEx.SystemBackdrop>

    <Grid x:Name="RootGrid">
        <Grid.Resources>
            <Style
                x:Key="FlyoutButtonStyle"
                BasedOn="{StaticResource SubtleButtonStyle}"
                TargetType="Button">
                <Setter Property="Padding" Value="6" />
                <Setter Property="Width" Value="32" />
                <Setter Property="Height" Value="32" />
                <Setter Property="FontFamily" Value="{ThemeResource SymbolThemeFontFamily}" />
            </Style>
        </Grid.Resources>
        <Border x:Name="MainContainer">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="48" />
                </Grid.RowDefinitions>

                <!--  Main Content Area with modern design  -->
                <Border
                    x:Name="ContentArea"
                    Background="{ThemeResource LayerOnAcrylicFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1">
                    <Grid>
                        <StackPanel
                            Margin="0,16,0,16"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Orientation="Vertical"
                            Spacing="16"
                            Visibility="{x:Bind ConvertBoolToVisibility(ViewModel.IsScanning), Mode=OneWay}">
                            <ProgressRing
                                Width="24"
                                Height="24"
                                Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                IsActive="True" />
                            <TextBlock
                                x:Name="ScanningMonitorsTextBlock"
                                x:Uid="ScanningMonitorsText"
                                HorizontalAlignment="Center"
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextAlignment="Center" />
                        </StackPanel>

                        <!--  No Monitors State with InfoBar  -->
                        <InfoBar
                            x:Name="NoMonitorsInfoBar"
                            x:Uid="NoMonitorsText"
                            IconSource="{ui:FontIconSource Glyph=&#xE7F4;}"
                            IsClosable="False"
                            IsOpen="{x:Bind ViewModel.ShowNoMonitorsMessage, Mode=OneWay}"
                            Severity="Informational"
                            Visibility="{x:Bind ConvertBoolToVisibility(ViewModel.ShowNoMonitorsMessage), Mode=OneWay}" />

                        <!--  Content Area  -->
                        <ScrollViewer
                            x:Name="MainScrollViewer"
                            Padding="16,16,16,16"
                            VerticalAlignment="Stretch"
                            HorizontalScrollBarVisibility="Disabled"
                            HorizontalScrollMode="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            ZoomMode="Disabled">
                            <!--  Monitors List with modern card design  -->
                            <ItemsRepeater
                                x:Name="MonitorsRepeater"
                                HorizontalAlignment="Stretch"
                                ItemsSource="{x:Bind ViewModel.Monitors, Mode=OneWay}"
                                Visibility="{x:Bind ConvertBoolToVisibility(ViewModel.HasMonitors), Mode=OneWay}">
                                <ItemsRepeater.Layout>
                                    <StackLayout Orientation="Vertical" Spacing="32" />
                                </ItemsRepeater.Layout>
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="vm:MonitorViewModel">
                                        <StackPanel HorizontalAlignment="Stretch" Spacing="4">
                                            <!--  Monitor Name with Icon  -->
                                            <Grid Margin="2,0,0,0" HorizontalAlignment="Stretch">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="22" />
                                                    <ColumnDefinition Width="16" />
                                                    <!--  Spacing  -->
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <local:MonitorIcon
                                                    VerticalAlignment="Center"
                                                    IsBuiltIn="{x:Bind IsInternal, Mode=OneWay}"
                                                    MonitorNumber="{x:Bind MonitorNumber, Mode=OneWay}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="0,0,0,2"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind DisplayName, Mode=OneWay}" />
                                                <Button
                                                    Grid.Column="2"
                                                    HorizontalAlignment="Right"
                                                    Content="{ui:FontIcon Glyph=&#xE712;,
                                                                          FontSize=16}"
                                                    Style="{StaticResource SubtleButtonStyle}"
                                                    Visibility="{x:Bind ConvertBoolToVisibility(ShowInputSource), Mode=OneWay}">
                                                    <Button.Flyout>
                                                        <Flyout>
                                                            <StackPanel Orientation="Vertical">
                                                                <ListView
                                                                    ItemsSource="{x:Bind AvailableInputSources, Mode=OneWay}"
                                                                    SelectionChanged="InputSourceListView_SelectionChanged"
                                                                    SelectionMode="Single">
                                                                    <ListView.Header>
                                                                        <TextBlock
                                                                            Margin="16,0,8,0"
                                                                            FontSize="12"
                                                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                            Text="Input source" />
                                                                    </ListView.Header>
                                                                    <ListView.ItemTemplate>
                                                                        <DataTemplate x:DataType="vm:InputSourceItem">
                                                                            <Grid Padding="0,4">
                                                                                <Grid.ColumnDefinitions>
                                                                                    <ColumnDefinition Width="*" />
                                                                                    <ColumnDefinition Width="Auto" />
                                                                                </Grid.ColumnDefinitions>
                                                                                <TextBlock
                                                                                    VerticalAlignment="Center"
                                                                                    Text="{x:Bind Name}" />
                                                                                <FontIcon
                                                                                    Grid.Column="1"
                                                                                    Margin="8,0,0,0"
                                                                                    FontSize="12"
                                                                                    Glyph="&#xE73E;"
                                                                                    Visibility="{x:Bind SelectionVisibility}" />
                                                                            </Grid>
                                                                        </DataTemplate>
                                                                    </ListView.ItemTemplate>
                                                                </ListView>
                                                            </StackPanel>
                                                        </Flyout>
                                                    </Button.Flyout>
                                                </Button>
                                            </Grid>
                                            <StackPanel
                                                Margin="0,8,0,0"
                                                Padding="8,0,16,8"
                                                Background="{ThemeResource LayerOnAcrylicFillColorDefaultBrush}"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1"
                                                CornerRadius="{StaticResource OverlayCornerRadius}">
                                                <!--  Brightness Control  -->
                                                <Grid Margin="0,8,0,0" HorizontalAlignment="Stretch">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="16" />
                                                        <ColumnDefinition Width="16" />
                                                        <!--  Spacing  -->
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <FontIcon
                                                        x:Uid="BrightnessTooltip"
                                                        VerticalAlignment="Center"
                                                        AutomationProperties.AccessibilityView="Raw"
                                                        FontSize="18"
                                                        Glyph="&#xEC8A;" />
                                                    <Slider
                                                        x:Uid="BrightnessAutomation"
                                                        Grid.Column="2"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        DataContext="{x:Bind}"
                                                        IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}"
                                                        Maximum="{x:Bind MaxBrightness, Mode=OneWay}"
                                                        Minimum="{x:Bind MinBrightness, Mode=OneWay}"
                                                        PointerCaptureLost="Slider_PointerCaptureLost"
                                                        Tag="Brightness"
                                                        ValueChanged="Slider_ValueChanged"
                                                        Value="{x:Bind Brightness, Mode=OneWay}" />
                                                </Grid>

                                                <!--  Contrast Control  -->
                                                <Grid
                                                    Margin="0,8,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    Visibility="{x:Bind ConvertBoolToVisibility(ShowContrast), Mode=OneWay}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="16" />
                                                        <ColumnDefinition Width="16" />
                                                        <!--  Spacing  -->
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <FontIcon
                                                        x:Uid="ContrastTooltip"
                                                        VerticalAlignment="Center"
                                                        AutomationProperties.AccessibilityView="Raw"
                                                        FontSize="12"
                                                        Glyph="&#xE7A1;" />

                                                    <Slider
                                                        x:Uid="ContrastAutomation"
                                                        Grid.Column="2"
                                                        VerticalAlignment="Center"
                                                        DataContext="{x:Bind}"
                                                        IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}"
                                                        Maximum="100"
                                                        Minimum="0"
                                                        PointerCaptureLost="Slider_PointerCaptureLost"
                                                        Tag="Contrast"
                                                        ValueChanged="Slider_ValueChanged"
                                                        Value="{x:Bind ContrastPercent, Mode=OneWay}" />
                                                </Grid>

                                                <!--  Volume Control  -->
                                                <Grid
                                                    Margin="0,8,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    Visibility="{x:Bind ConvertBoolToVisibility(ShowVolume), Mode=OneWay}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="16" />
                                                        <ColumnDefinition Width="16" />
                                                        <!--  Spacing  -->
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <FontIcon
                                                        x:Uid="VolumeTooltip"
                                                        Margin="2,0,0,0"
                                                        VerticalAlignment="Center"
                                                        AutomationProperties.AccessibilityView="Raw"
                                                        FontSize="16"
                                                        Glyph="&#xE993;" />
                                                    <Slider
                                                        x:Uid="VolumeAutomation"
                                                        Grid.Column="2"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        DataContext="{x:Bind}"
                                                        IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}"
                                                        Maximum="{x:Bind MaxVolume, Mode=OneWay}"
                                                        Minimum="{x:Bind MinVolume, Mode=OneWay}"
                                                        PointerCaptureLost="Slider_PointerCaptureLost"
                                                        Tag="Volume"
                                                        ValueChanged="Slider_ValueChanged"
                                                        Value="{x:Bind Volume, Mode=OneWay}" />
                                                </Grid>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <Grid x:Name="StatusBar" Grid.Row="1">
                    <!--  Action Buttons  -->
                    <StackPanel
                        Margin="0,0,8,8"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="8">
                        <Button Content="{ui:FontIcon Glyph=&#xE748;, FontSize=16}" Style="{StaticResource SubtleButtonStyle}">
                            <Button.Flyout>
                                <Flyout>
                                    <ListView SelectedIndex="2">
                                        <ListView.Header>
                                            <TextBlock
                                                Margin="16,0,8,0"
                                                FontSize="12"
                                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                Text="Profiles" />
                                        </ListView.Header>
                                        <ListViewItem Content="Profile 1" />
                                        <ListViewItem Content="Profile 2" />
                                        <ListViewItem Content="Profile 3" />
                                    </ListView>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            x:Name="LinkButton"
                            x:Uid="SyncAllMonitorsTooltip"
                            Click="OnLinkClick"
                            Content="{ui:FontIcon Glyph=&#xE71B;,
                                                  FontSize=16}"
                            Style="{StaticResource SubtleButtonStyle}" />
                        <Button
                            x:Name="RefreshButton"
                            x:Uid="RefreshTooltip"
                            Click="OnRefreshClick"
                            Content="{ui:FontIcon Glyph=&#xE72C;,
                                                  FontSize=16}"
                            Style="{StaticResource SubtleButtonStyle}" />
                        <Button
                            x:Name="IdentifyButton"
                            x:Uid="IdentifyTooltip"
                            Command="{x:Bind ViewModel.IdentifyMonitorsCommand}"
                            Content="{ui:FontIcon Glyph=&#xE9D9;,
                                                  FontSize=16}"
                            Style="{StaticResource SubtleButtonStyle}" />
                        <Button
                            x:Name="SettingsBtn"
                            x:Uid="SettingsTooltip"
                            Padding="6"
                            Click="OnSettingsClick"
                            Style="{StaticResource FlyoutButtonStyle}">
                            <ToolTipService.ToolTip>
                                <TextBlock x:Uid="SettingsTooltip" />
                            </ToolTipService.ToolTip>
                            <AnimatedIcon x:Name="SearchAnimatedIcon">
                                <AnimatedIcon.Source>
                                    <animatedVisuals:AnimatedSettingsVisualSource />
                                </AnimatedIcon.Source>
                                <AnimatedIcon.FallbackIconSource>
                                    <SymbolIconSource Symbol="Setting" />
                                </AnimatedIcon.FallbackIconSource>
                            </AnimatedIcon>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</winuiex:WindowEx>