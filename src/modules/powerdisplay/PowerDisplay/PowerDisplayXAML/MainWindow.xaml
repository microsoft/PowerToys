<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="PowerDisplay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PowerDisplay.ViewModels"
        xmlns:converters="using:PowerDisplay.Converters"
        xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
        xmlns:ui="using:CommunityToolkit.WinUI"
        xmlns:animations="using:CommunityToolkit.WinUI.Animations">
    <Grid x:Name="RootGrid">
        <Grid.RenderTransform>
            <TranslateTransform x:Name="RootGridTransform" X="0" />
        </Grid.RenderTransform>

        <Grid.Resources>
            <!-- Enhanced Slide-in animation storyboard -->
            <Storyboard x:Key="SlideInStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGridTransform"
                               Storyboard.TargetProperty="X"
                               From="300"
                               To="0"
                               Duration="0:0:0.4">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="RootGrid"
                               Storyboard.TargetProperty="Opacity"
                               From="0"
                               To="1"
                               Duration="0:0:0.3" />
                <DoubleAnimation Storyboard.TargetName="MainContainer"
                               Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                               From="20"
                               To="0"
                               Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>

            <!-- Enhanced Slide-out animation storyboard -->
            <Storyboard x:Key="SlideOutStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGridTransform"
                               Storyboard.TargetProperty="X"
                               From="0"
                               To="300"
                               Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseIn" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="RootGrid"
                               Storyboard.TargetProperty="Opacity"
                               From="1"
                               To="0"
                               Duration="0:0:0.2" />
            </Storyboard>
        </Grid.Resources>

        <!-- Main Container with modern design -->
        <Border x:Name="MainContainer"
                CornerRadius="8"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                Margin="0"
                MaxWidth="640"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Top">
            <Border.RenderTransform>
                <TranslateTransform Y="0" />
            </Border.RenderTransform>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Content Area -->
                <ScrollViewer Grid.Row="0"
                             ZoomMode="Disabled"
                             HorizontalScrollMode="Disabled"
                             HorizontalScrollBarVisibility="Disabled"
                             VerticalScrollBarVisibility="Auto"
                             MaxHeight="420"
                             Padding="8">

                    <StackPanel Spacing="4">

                        <!-- Loading State with modern progress -->
                        <StackPanel Orientation="Vertical"
                                   Spacing="16"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="{x:Bind ConvertBoolToVisibility(ViewModel.IsScanning), Mode=OneWay}">
                            <ProgressRing IsActive="True"
                                         Width="32"
                                         Height="32"
                                         Foreground="{ThemeResource AccentFillColorDefaultBrush}" />
                            <TextBlock x:Name="ScanningMonitorsTextBlock"
                                      FontSize="12"
                                      HorizontalAlignment="Center"
                                      TextAlignment="Center" />
                        </StackPanel>

                        <!-- No Monitors State with InfoBar -->
                        <InfoBar x:Name="NoMonitorsInfoBar"
                                        IsOpen="{x:Bind ViewModel.ShowNoMonitorsMessage, Mode=OneWay}"
                                        Severity="Informational"
                                        IsClosable="False"
                                        Background="{ThemeResource InfoBarInformationalSeverityBackgroundBrush}">
                            <InfoBar.IconSource>
                                <FontIconSource Glyph="&#xE7F4;" />
                            </InfoBar.IconSource>
                            <TextBlock x:Name="NoMonitorsTextBlock" />
                        </InfoBar>

                        <!-- Monitors List with modern card design -->
                        <ItemsControl ItemsSource="{x:Bind ViewModel.Monitors, Mode=OneWay}"
                                     Visibility="{x:Bind ConvertBoolToVisibility(ViewModel.HasMonitors), Mode=OneWay}"
                                     HorizontalAlignment="Stretch">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"
                                               Spacing="0">
                                        <StackPanel.ChildrenTransitions>
                                            <TransitionCollection>
                                                <EntranceThemeTransition FromVerticalOffset="20" />
                                                <RepositionThemeTransition IsStaggeringEnabled="True" />
                                            </TransitionCollection>
                                        </StackPanel.ChildrenTransitions>
                                    </StackPanel>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:MonitorViewModel">
                                    <StackPanel Spacing="2" HorizontalAlignment="Stretch">
                                        <StackPanel.ChildrenTransitions>
                                            <TransitionCollection>
                                                <EntranceThemeTransition FromVerticalOffset="8" />
                                                <RepositionThemeTransition />
                                            </TransitionCollection>
                                        </StackPanel.ChildrenTransitions>

                                        <!-- Monitor Name with Icon -->
                                        <StackPanel Orientation="Horizontal"
                                                    Spacing="12"
                                                    Padding="12,8">
                                            <FontIcon Glyph="{x:Bind MonitorIconGlyph, Mode=OneWay}"
                                                      FontSize="20"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center" />
                                            <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                      FontSize="20"
                                                      FontWeight="SemiBold"
                                                      VerticalAlignment="Center" />
                                        </StackPanel>

                                                    <!-- Brightness Control -->
                                                    <Grid Height="40" HorizontalAlignment="Stretch">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE793;"
                                                                 FontSize="14"
                                                                 VerticalAlignment="Center"
                                                                 HorizontalAlignment="Center" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               MinHeight="32"
                                                               VerticalAlignment="Center"
                                                               Margin="0,2"
                                                               Minimum="{x:Bind MinBrightness, Mode=OneWay}"
                                                               Maximum="{x:Bind MaxBrightness, Mode=OneWay}"
                                                               Value="{x:Bind Brightness, Mode=OneWay}"
                                                               ValueChanged="Slider_ValueChanged"
                                                               PointerCaptureLost="Slider_PointerCaptureLost"
                                                               Tag="Brightness"
                                                               IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}" />

                                                        <TextBlock Grid.Column="2"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"
                                                                  Text="{x:Bind Brightness, Mode=OneWay}" />
                                                    </Grid>

                                                    <!-- Color Temperature Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{x:Bind ConvertBoolToVisibility(ShowColorTemperature), Mode=OneWay}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE790;"
                                                                 FontSize="14"
                                                                 VerticalAlignment="Center"
                                                                 HorizontalAlignment="Center" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               MinHeight="32"
                                                               VerticalAlignment="Center"
                                                               Margin="0,2"
                                                               Minimum="0"
                                                               Maximum="100"
                                                               Value="{x:Bind ColorTemperaturePercent, Mode=OneWay}"
                                                               ValueChanged="Slider_ValueChanged"
                                                               PointerCaptureLost="Slider_PointerCaptureLost"
                                                               Tag="ColorTemperature"
                                                               IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}" />

                                                        <TextBlock Grid.Column="2"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center">
                                                            <Run Text="{x:Bind ColorTemperature, Mode=OneWay}" />
                                                            <Run Text="K" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                                    <!-- Contrast Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{x:Bind ConvertBoolToVisibility(ShowContrast), Mode=OneWay}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE7A6;"
                                                                 FontSize="14"
                                                                 VerticalAlignment="Center"
                                                                 HorizontalAlignment="Center" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               MinHeight="32"
                                                               VerticalAlignment="Center"
                                                               Margin="0,2"
                                                               Minimum="0"
                                                               Maximum="100"
                                                               Value="{x:Bind ContrastPercent, Mode=OneWay}"
                                                               ValueChanged="Slider_ValueChanged"
                                                               PointerCaptureLost="Slider_PointerCaptureLost"
                                                               Tag="Contrast"
                                                               IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}" />

                                                        <TextBlock Grid.Column="2"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center">
                                                            <Run Text="{x:Bind Contrast, Mode=OneWay}" />
                                                            <Run Text="%" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                                    <!-- Volume Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{x:Bind ConvertBoolToVisibility(ShowVolume), Mode=OneWay}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE767;"
                                                                 FontSize="14"
                                                                 VerticalAlignment="Center"
                                                                 HorizontalAlignment="Center" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               MinHeight="32"
                                                               VerticalAlignment="Center"
                                                               Margin="0,2"
                                                               Minimum="{x:Bind MinVolume, Mode=OneWay}"
                                                               Maximum="{x:Bind MaxVolume, Mode=OneWay}"
                                                               Value="{x:Bind Volume, Mode=OneWay}"
                                                               ValueChanged="Slider_ValueChanged"
                                                               PointerCaptureLost="Slider_PointerCaptureLost"
                                                               Tag="Volume"
                                                               IsEnabled="{x:Bind IsInteractionEnabled, Mode=OneWay}" />

                                                        <TextBlock Grid.Column="2"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center">
                                                            <Run Text="{x:Bind Volume, Mode=OneWay}" />
                                                            <Run Text="%" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- Status Bar with modern design -->
                <Grid Grid.Row="1"
                      BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                      BorderThickness="0,1,0,0"
                      Padding="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Status Information -->
                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock x:Name="AdjustBrightnessTextBlock"
                                  FontSize="16"
                                  FontWeight="SemiBold" />
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="1"
                               Orientation="Horizontal"
                               Spacing="4"
                               VerticalAlignment="Center">
                        <Button x:Name="LinkButton"
                               Width="40"
                               Height="40"
                               CornerRadius="4"
                               Background="Transparent"
                               BorderThickness="0"
                               ToolTipService.ToolTip="Sync all monitors">
                            <FontIcon Glyph="&#xE71B;" FontSize="16" />
                        </Button>
                        <Button x:Name="DisableButton"
                               Width="40"
                               Height="40"
                               CornerRadius="4"
                               Background="Transparent"
                               BorderThickness="0"
                               ToolTipService.ToolTip="Toggle control">
                            <FontIcon Glyph="&#xE7E8;" FontSize="16" />
                        </Button>
                        <Button x:Name="RefreshButton"
                               Width="40"
                               Height="40"
                               CornerRadius="4"
                               Background="Transparent"
                               BorderThickness="0"
                               ToolTipService.ToolTip="Refresh monitors">
                            <FontIcon Glyph="&#xE72C;" FontSize="16" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>