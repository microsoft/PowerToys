<Project Sdk="Microsoft.NET.Sdk">
  <!-- Standard PowerToys Imports -->
  <Import Project="..\..\..\Common.Dotnet.CsWinRT.props" />
  <Import Project="..\..\..\Common.SelfContained.props" />

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <!-- Use the module-specific output folder so the C++ DLL finds the EXE -->
    <OutputPath>..\..\..\..\$(Platform)\$(Configuration)</OutputPath>
    <UseWinUI>true</UseWinUI>
    <ApplicationManifest>app.manifest</ApplicationManifest>
    
    <!-- Naming and Identity -->
    <AssemblyName>PowerToys.KeystrokeOverlay</AssemblyName>
    <RootNamespace>KeystrokeOverlay</RootNamespace>
    
    <!-- WinUI 3 Packaging Settings -->
    <WindowsPackageType>None</WindowsPackageType>
    <WindowsAppSDKSelfContained>true</WindowsAppSDKSelfContained>
    <EnablePreviewMsixTooling>true</EnablePreviewMsixTooling>
    <ProjectPriFileName>PowerToys.KeystrokeOverlayUI.pri</ProjectPriFileName>
    
    <!-- Platform Settings -->
    <Platforms>x64;ARM64</Platforms>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
    
    <!-- Allow unsafe blocks if you do any P/Invoke, good practice to enable in PT modules -->
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.WindowsAppSDK" />
    <PackageReference Include="Microsoft.Windows.SDK.BuildTools" />
    <PackageReference Include="Microsoft.Extensions.Hosting" />
    <PackageReference Include="System.Text.Json" />
    <Manifest Include="$(ApplicationManifest)" />
  </ItemGroup>

  <!-- PowerToys Internal Dependencies -->
  <ItemGroup>
    <!-- HACK: Common.UI is referenced, even if it is not used, to force dll versions to be the same as in other projects that use it. It's still unclear why this is the case, but this is need for flattening the install directory. -->
    <ProjectReference Include="..\..\..\common\Common.UI\Common.UI.csproj" />
    <ProjectReference Include="..\..\..\common\ManagedCommon\ManagedCommon.csproj" />
    <ProjectReference Include="..\..\..\common\LanguageModelProvider\LanguageModelProvider.csproj" />
    <ProjectReference Include="..\..\..\common\GPOWrapper\GPOWrapper.vcxproj" />
    <ProjectReference Include="..\..\..\common\interop\PowerToys.Interop.vcxproj" />
    <ProjectReference Include="..\..\..\settings-ui\Settings.UI.Library\Settings.UI.Library.csproj" />
  </ItemGroup>

  <!-- Ensure Views are compiled correctly -->
  <ItemGroup>
    <Page Update="Views\KeyVisual.xaml">
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <!-- If you have other views in subfolders, ensure they are updated here -->
  </ItemGroup>
</Project>