<Project Sdk="Microsoft.NET.Sdk">
  <!-- Standard PowerToys Imports -->
  <Import Project="..\..\..\Common.Dotnet.CsWinRT.props" />
  <Import Project="..\..\..\Common.SelfContained.props" />

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <OutputPath>..\..\..\..\$(Platform)\$(Configuration)\WinUI3Apps</OutputPath>
    <UseWinUI>true</UseWinUI>
    <ApplicationManifest>app.manifest</ApplicationManifest>

    <AssemblyName>PowerToys.KeystrokeOverlayUI</AssemblyName>
    <RootNamespace>PowerToys.KeystrokeOverlayUI</RootNamespace>

    <WindowsPackageType>None</WindowsPackageType>

    <!-- ðŸ”¥ Forces Microsoft.UI.Xaml.dll + all WinAppSDK files into EXE folder -->
    <WindowsAppSDKSelfContained>true</WindowsAppSDKSelfContained>
    <SelfContained>true</SelfContained>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>

    <EnablePreviewMsixTooling>true</EnablePreviewMsixTooling>
    <ProjectPriFileName>PowerToys.KeystrokeOverlayUI.pri</ProjectPriFileName>

    <Platforms>x64;ARM64</Platforms>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>

    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <GenerateSatelliteAssembliesForCore>true</GenerateSatelliteAssembliesForCore>
</PropertyGroup>

<ItemGroup>
  <RuntimeHostConfigurationOption Include="MVVMTOOLKIT_ENABLE_INOTIFYPROPERTYCHANGING_SUPPORT" Value="true" />
</ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.WindowsAppSDK" />
    <PackageReference Include="Microsoft.Windows.SDK.BuildTools" />
    <PackageReference Include="Microsoft.Extensions.Hosting" />
    <PackageReference Include="System.Text.Json" />
    <Manifest Include="$(ApplicationManifest)" />
  </ItemGroup>

  <!-- PowerToys Internal Dependencies -->
  <ItemGroup>
    <!-- HACK: Common.UI is referenced, even if it is not used, to force dll versions to be the same as in other projects that use it. It's still unclear why this is the case, but this is need for flattening the install directory. -->
    <ProjectReference Include="..\..\..\common\Common.UI\Common.UI.csproj" />
    <ProjectReference Include="..\..\..\common\ManagedCommon\ManagedCommon.csproj" />
    <ProjectReference Include="..\..\..\common\LanguageModelProvider\LanguageModelProvider.csproj" />
    <ProjectReference Include="..\..\..\common\GPOWrapper\GPOWrapper.vcxproj" />
    <ProjectReference Include="..\..\..\common\interop\PowerToys.Interop.vcxproj" />
    <ProjectReference Include="..\..\..\settings-ui\Settings.UI.Library\Settings.UI.Library.csproj" />
  </ItemGroup>

  <!-- Ensure Views are compiled correctly -->
  <ItemGroup>
    <Page Update="Views\KeyVisual.xaml">
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <!-- If you have other views in subfolders, ensure they are updated here -->
  </ItemGroup>
</Project>