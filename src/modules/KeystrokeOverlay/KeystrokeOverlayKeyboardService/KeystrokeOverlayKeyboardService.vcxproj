<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="..\..\..\..\packages\Microsoft.Windows.CppWinRT.2.0.240111.5\build\native\Microsoft.Windows.CppWinRT.props"
          Condition="Exists('..\..\..\..\packages\Microsoft.Windows.CppWinRT.2.0.240111.5\build\native\Microsoft.Windows.CppWinRT.props')" />

  <PropertyGroup Label="Globals">
    <VCProjectVersion>15.0</VCProjectVersion>
    <ProjectGuid>{A1B2C3D4-E5F6-4321-8765-123456789ABC}</ProjectGuid>
    <Keyword>Win32Proj</Keyword>
    <RootNamespace>KeystrokeOverlay</RootNamespace>
    <ProjectName>KeystrokeOverlayKeyboardService</ProjectName>
  </PropertyGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />

  <PropertyGroup Label="Configuration">
    <ConfigurationType>StaticLibrary</ConfigurationType>
  </PropertyGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />

  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props"
            Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')"
            Label="LocalAppDataPlatform" />
  </ImportGroup>

  <PropertyGroup>
    <OutDir>..\..\..\..\$(Platform)\$(Configuration)\WinUI3Apps\</OutDir>
  </PropertyGroup>

  <ItemDefinitionGroup>
    <ClCompile>
      <PreprocessorDefinitions>_WINDOWS;_LIB;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <AdditionalIncludeDirectories>..\..\..\common\inc;..\..\..\common\Telemetry;..\..\;..\..\..\;%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
    </ClCompile>
  </ItemDefinitionGroup>

  <ItemGroup>
    <ClInclude Include="pch.h" />
    <ClInclude Include="Batcher.h" />
    <ClInclude Include="EventQueue.h" />
    <ClInclude Include="KeystrokeEvent.h" />
    <ClInclude Include="Pipeserver.h" />
  </ItemGroup>

  <ItemGroup>
    <ClCompile Include="Batcher.cpp" />
    <ClCompile Include="Pipeserver.cpp" />
    <ClCompile Include="pch.cpp">
      <PrecompiledHeader Condition="'$(UsePrecompiledHeaders)' != 'false'">Create</PrecompiledHeader>
    </ClCompile>

    <!-- â­ Forces build pipeline to run so AfterTargets executes -->
    <ClCompile Include="ForceBuild.cpp" />
  </ItemGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <Import Project="..\..\..\..\deps\spdlog.props" />

  <Target Name="CopyKeystrokeServerToOutput" AfterTargets="Build">
    <Message Text="Copying KeystrokeServer.exe to output folder..." Importance="high" />
    <Copy
      SourceFiles="$(ProjectDir)KeystrokeServer.exe"
      DestinationFiles="$(OutDir)PowerToys.KeystrokeOverlayKeystrokeServer.exe"
      SkipUnchangedFiles="true"
      Condition="Exists('$(ProjectDir)KeystrokeServer.exe')" />
  </Target>

</Project>
