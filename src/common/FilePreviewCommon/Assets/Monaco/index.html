<!doctype HTML>
<html>
<head>
    <script>
        var editor;
    </script>
    <!-- Set browser to Edge-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Set charset -->
    <meta charset="utf-8" />
    <!-- Title (normally not displayed)-->
    <title>Previewer for developer Files</title>
    <style>
        /* Fits content to window size */
        html, body {
            padding: 0;
        }

        #container, .monaco-editor {
            position: fixed;
            height: 100%;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
        }

        .overflowingContentWidgets {
            /*Hides alert box */
            display: none !important
        }
    </style>
</head>

<body>
    <!-- Container for the editor -->
    <div style="font-size:xx-large;position: absolute;top: 50%; right: 50%;background-color: transparent;transform: translate(50%,-50%);">...</div>
    <div id="container" style="z-index: 100;"></div>
    <!-- Script -->
    <script src="/monacoSRC/min/vs/loader.js"></script>
    <script src="/monacoSpecialLanguages.js" type="module"></script>
    <script type="module">
        import { registerAdditionalLanguages } from "/monacoSpecialLanguages.js";
        window.addEventListener("DOMContentLoaded", function () {
            require.config({ paths: { vs: '/monacoSRC/min/vs' } });
            require(['vs/editor/editor.main'], async function () {
                await registerAdditionalLanguages(monaco)
                // Creates the editor
                // For all parameters: https://microsoft.github.io/monaco-editor/api/interfaces/monaco.editor.istandaloneeditorconstructionoptions.html
                editor = monaco.editor.create(document.getElementById('container'), {
                    readOnly: true, // Sets to readonly
                    minimap: {enabled: false}, // Disables minimap
                    lineNumbersMinChars: "3", //Width of the line numbers
                    scrollbar: {
                        // Deactivate shadows
                        shadows: false,

                        // Render scrollbar automatically
                        vertical: 'auto',
                        horizontal: 'auto',
                    },
                });
                window.onresize = function (){
                    editor.layout();
                };

                // Code taken from stackoverflow.com/a/30106551/14774889
                onContextMenu();
                // Add switch wrap button to context menu
                editor.addAction({
                    id: 'text-wrap',
    
                    label: 'Toggle text wrapping',
    
                    // A precondition for this action.
                    precondition: null,
    
                    // A rule to evaluate on top of the precondition in order to dispatch the keybindings.
                    keybindingContext: null,
    
                    contextMenuGroupId: 'cutcopypaste',
    
                    contextMenuOrder: 100,
    
                    // Method that will be executed when the action is triggered.
                    // @param editor The editor instance is passed in as a convenience
                    run: function (ed) {
                        if(wrap){
                            editor.updateOptions({ wordWrap: "off" })
                        }else{
                            editor.updateOptions({ wordWrap: "on" })
                        }
                        wrap = !wrap;
                    }
                });
            });
        });

        function onContextMenu() {
            // Hide context menu items
            // Code modified from https://stackoverflow.com/questions/48745208/disable-cut-and-copy-in-context-menu-in-monaco-editor/65413517#65413517
            let menus = require('vs/platform/actions/common/actions').MenuRegistry._menuItems
            let contextMenuEntry = [...menus].find(entry => entry[0].id == 'EditorContext')
            let contextMenuLinks = contextMenuEntry[1]

            let removableIds = ['editor.action.clipboardCutAction', 'editor.action.formatDocument', 'editor.action.formatSelection', 'editor.action.quickCommand', 'editor.action.quickOutline', 'editor.action.refactor', 'editor.action.sourceAction', 'editor.action.rename', undefined, 'editor.action.revealDefinition', 'editor.action.revealDeclaration', 'editor.action.goToTypeDefinition', 'editor.action.goToImplementation', 'editor.action.goToReferences', 'editor.action.changeAll']

            let removeById = (list, ids) => {
                let node = list._first
                do {
                    if (node.element == undefined) break;
                    let shouldRemove = ids.includes(node.element?.command?.id)
                    if (shouldRemove) { list._remove(node) }
                } while ((node = node.next))
            }

            removeById(contextMenuLinks, removableIds)
        }
    </script>
</body>
</html>
