<Page
    x:Class="Microsoft.PowerToys.Settings.UI.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Lib="using:Microsoft.PowerToys.Settings.UI.Library"
    xmlns:controls="using:Microsoft.PowerToys.Settings.UI.Controls"
    xmlns:converters="using:Microsoft.PowerToys.Settings.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tkcontrols="using:CommunityToolkit.WinUI.Controls"
    xmlns:tkconverters="using:CommunityToolkit.WinUI.Converters"
    xmlns:viewModels="using:Microsoft.PowerToys.Settings.UI.ViewModels"
    AutomationProperties.LandmarkType="Main"
    DataContext="DashboardViewModel"
    mc:Ignorable="d">

    <Page.Resources>
        <DataTemplate x:Key="KeyVisualTemplate">
            <controls:KeyVisual
                VerticalAlignment="Center"
                AutomationProperties.AccessibilityView="Raw"
                Content="{Binding}"
                IsTabStop="False"
                VisualType="TextOnly" />
        </DataTemplate>
        <DataTemplate x:Key="CommaTemplate">
            <StackPanel Background="{ThemeResource SystemFillColorSolidAttentionBackground}">
                <TextBlock
                    Margin="4,0"
                    VerticalAlignment="Bottom"
                    Text="," />
            </StackPanel>
        </DataTemplate>
        <converters:KeyVisualTemplateSelector
            x:Key="KeyVisualTemplateSelector"
            CommaTemplate="{StaticResource CommaTemplate}"
            KeyVisualTemplate="{StaticResource KeyVisualTemplate}" />
        <converters:ModuleItemTemplateSelector
            x:Key="ModuleItemTemplateSelector"
            ButtonTemplate="{StaticResource ModuleItemButtonTemplate}"
            KBMTemplate="{StaticResource ModuleItemKBMTemplate}"
            ShortcutTemplate="{StaticResource ModuleItemShortcutTemplate}"
            TextTemplate="{StaticResource ModuleItemTextTemplate}" />
        <tkconverters:CollectionVisibilityConverter x:Key="CollectionVisibilityConverter" />
        <Style x:Name="KeysListViewContainerStyle" TargetType="ListViewItem">
            <Setter Property="IsTabStop" Value="False" />
        </Style>
        <converters:UpdateStateToBoolConverter x:Key="UpdateStateToBoolConverter" />
        <tkconverters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <tkconverters:BoolNegationConverter x:Key="BoolNegationConverter" />
        <tkconverters:BoolToVisibilityConverter
            x:Key="BoolToInvertedVisibilityConverter"
            FalseValue="Visible"
            TrueValue="Collapsed" />
        <DataTemplate x:Key="OriginalKeyTemplate" x:DataType="x:String">
            <controls:KeyVisual Content="{Binding}" VisualType="SmallOutline" />
        </DataTemplate>

        <DataTemplate x:Key="RemappedKeyTemplate" x:DataType="x:String">
            <controls:KeyVisual Content="{Binding}" VisualType="Small" />
        </DataTemplate>

        <DataTemplate x:Key="ModuleItemTextTemplate" x:DataType="viewModels:DashboardModuleTextItem">
            <TextBlock
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Style="{StaticResource CaptionTextBlockStyle}"
                Text="{x:Bind Label, Mode=OneWay}"
                TextWrapping="WrapWholeWords" />
        </DataTemplate>

        <DataTemplate x:Key="ModuleItemButtonTemplate" x:DataType="viewModels:DashboardModuleButtonItem">
            <Button
                HorizontalAlignment="Stretch"
                Click="{x:Bind ButtonClickHandler, Mode=OneWay}"
                Content="{x:Bind ButtonTitle}" />
        </DataTemplate>

        <DataTemplate x:Key="ModuleItemShortcutTemplate" x:DataType="viewModels:DashboardModuleShortcutItem">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border
                    Padding="8,4"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource ControlCornerRadius}">
                    <ItemsControl
                        AutomationProperties.AccessibilityView="Raw"
                        IsTabStop="False"
                        ItemsSource="{x:Bind Shortcut, Mode=TwoWay}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="12" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <controls:KeyVisual
                                    VerticalAlignment="Center"
                                    AutomationProperties.AccessibilityView="Raw"
                                    Content="{Binding}"
                                    IsTabStop="False"
                                    VisualType="TextOnly" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>

                <TextBlock
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Text="{x:Bind Label, Mode=OneWay}"
                    TextWrapping="WrapWholeWords" />
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <Grid Margin="16,0,0,0" RowSpacing="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            x:Uid="DashboardTitle"
            MaxWidth="{StaticResource PageMaxWidth}"
            VerticalAlignment="Center"
            Style="{StaticResource TitleTextBlockStyle}" />

        <Grid Grid.Row="1" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Button
                Grid.Column="2"
                Click="SWVersionButtonClicked"
                Style="{StaticResource SubtleButtonStyle}"
                Visibility="{x:Bind ViewModel.UpdateAvailable, Mode=OneWay}">
                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <FontIcon
                        AutomationProperties.AccessibilityView="Raw"
                        FontSize="20"
                        Foreground="{ThemeResource AccentTextFillColorTertiaryBrush}"
                        Glyph="&#xE895;" />
                    <StackPanel Grid.Column="1" Orientation="Vertical">
                        <TextBlock x:Uid="UpdateAvailable" FontWeight="SemiBold" />
                        <TextBlock
                            x:Uid="LearnMore"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>
                </Grid>
            </Button>
        </Grid>

        <ScrollViewer x:Name="MainScrollViewer" Grid.Row="2">
            <Grid>
                <!--  This grid is required to ensure that the content is horizontally aligned  -->
                <Grid
                    MaxWidth="{StaticResource PageMaxWidth}"
                    ColumnSpacing="16"
                    RowSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <controls:Card Title="Quick launch" VerticalAlignment="Top" />
                    <controls:Card
                        Title="Shortcuts"
                        Grid.Row="1"
                        VerticalAlignment="Top" />
                    <controls:Card
                        Title="Modules"
                        Grid.RowSpan="2"
                        Grid.Column="1"
                        MinWidth="400"
                        Padding="0"
                        VerticalAlignment="Top"
                        DividerVisibility="Collapsed">
                        <!--<controls:Card.TitleContent>
                            <Button Content="Click" />
                        </controls:Card.TitleContent>-->
                        <ItemsRepeater
                            x:Name="DashboardView"
                            Grid.Row="2"
                            ItemsSource="{x:Bind ViewModel.AllModules, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Vertical" Spacing="0" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:DashboardListItem">
                                    <tkcontrols:SettingsCard
                                        MinHeight="0"
                                        Padding="16,4,16,4"
                                        AutomationProperties.Name="{x:Bind Label}"
                                        Background="Transparent"
                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                        BorderThickness="0,1,0,0"
                                        Click="DashboardListItemClick"
                                        CornerRadius="0"
                                        IsClickEnabled="True"
                                        Tag="{x:Bind Tag}">
                                        <tkcontrols:SettingsCard.Resources>
                                            <x:Double x:Key="SettingsCardWrapThreshold">0</x:Double>
                                        </tkcontrols:SettingsCard.Resources>
                                        <tkcontrols:SettingsCard.Header>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{x:Bind Label}" />
                                                <StackPanel
                                                    Grid.Column="1"
                                                    VerticalAlignment="Center"
                                                    Orientation="Horizontal">
                                                    <TextBlock
                                                        VerticalAlignment="Center"
                                                        FontWeight="SemiBold"
                                                        Text=""
                                                        TextTrimming="CharacterEllipsis" />
                                                    <InfoBadge
                                                        Margin="4,0,0,0"
                                                        Style="{StaticResource NewInfoBadge}"
                                                        Visibility="{x:Bind IsNew, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                </StackPanel>
                                                <FontIcon
                                                    Grid.Column="2"
                                                    Width="20"
                                                    Margin="0,0,-12,0"
                                                    FontSize="16"
                                                    Glyph="&#xE72E;"
                                                    Visibility="{x:Bind IsLocked, Converter={StaticResource BoolToInvertedVisibilityConverter}, ConverterParameter=True}">
                                                    <ToolTipService.ToolTip>
                                                        <TextBlock x:Uid="GPO_SettingIsManaged_ToolTip" TextWrapping="WrapWholeWords" />
                                                    </ToolTipService.ToolTip>
                                                </FontIcon>
                                            </StackPanel>
                                        </tkcontrols:SettingsCard.Header>
                                        <tkcontrols:SettingsCard.HeaderIcon>
                                            <ImageIcon>
                                                <ImageIcon.Source>
                                                    <BitmapImage UriSource="{x:Bind Icon}" />
                                                </ImageIcon.Source>
                                            </ImageIcon>
                                        </tkcontrols:SettingsCard.HeaderIcon>
                                        <ToggleSwitch
                                            IsEnabled="{x:Bind IsLocked, Converter={StaticResource BoolNegationConverter}, ConverterParameter=True, Mode=OneWay}"
                                            IsOn="{x:Bind IsEnabled, Mode=TwoWay}"
                                            OffContent=" "
                                            OnContent=" " />
                                    </tkcontrols:SettingsCard>


                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </controls:Card>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
