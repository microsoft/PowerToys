parameters:
  - name: displayName
    type: string
    default: Sign Specific Files
  - name: folder
    type: string
  - name: pattern
    type: string
  - name: signingIdentity
    type: object
    default: {}

steps:
  - template: steps-esrp-signing.yml
    parameters:
      displayName: ${{ parameters.displayName }}
      signingIdentity: ${{ parameters.signingIdentity }}
      inputs:
        FolderPath: ${{ parameters.folder }}
        Pattern: ${{ parameters.pattern }}
        UseMinimatch: true
        signConfigType: inlineSignParams
        inlineOperation: |-
          [
              {
                  "KeyCode": "CP-230012",
                  "OperationCode": "SigntoolSign",
                  "Parameters": {
                      "OpusName": "Microsoft",
                      "OpusInfo": "http://www.microsoft.com",
                      "FileDigest": "/fd \"SHA256\"",
                      "PageHash": "/NPH",
                      "TimeStamp": "/tr \"http://rfc3161.gtm.corp.microsoft.com/TSS/HttpTspServer\" /td sha256"
                  },
                  "ToolName": "sign",
                  "ToolVersion": "1.0"
              },
              {
                  "KeyCode": "CP-230012",
                  "OperationCode": "SigntoolVerify",
                  "Parameters": {},
                  "ToolName": "sign",
                  "ToolVersion": "1.0"
              }
          ]
