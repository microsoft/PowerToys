parameters:
  - name: versionNumber
    type: string
    default: 1.6
  - name: useExperimentalVersion
    type: boolean
    default: false
  # Artifact mode parameters
  - name: useArtifactSource
    type: boolean
    default: false
  - name: azureDevOpsOrg
    type: string
    default: 'https://dev.azure.com/microsoft'
  - name: azureDevOpsProject
    type: string
    default: 'ProjectReunion'
  - name: buildId
    type: string
    default: ''
  - name: artifactName
    type: string
    default: 'WindowsAppSDK_Nuget_And_MSIX'
  - name: metaPackageName
    type: string
    default: 'Microsoft.WindowsAppSDK'

steps:
- task: NuGetAuthenticate@1
  displayName: 'NuGet Authenticate'

- task: PowerShell@2
  displayName: Update WinAppSDK Versions
  inputs:
    filePath: '$(build.sourcesdirectory)\.pipelines\UpdateVersions.ps1'
    arguments: >
      -winAppSdkVersionNumber ${{ parameters.versionNumber }}
      -useExperimentalVersion $${{ parameters.useExperimentalVersion }}
      -rootPath "$(build.sourcesdirectory)"
      -useArtifactSource $${{ parameters.useArtifactSource }}
      -azureDevOpsOrg "${{ parameters.azureDevOpsOrg }}"
      -azureDevOpsProject "${{ parameters.azureDevOpsProject }}"
      -buildId "${{ parameters.buildId }}"
      -artifactName "${{ parameters.artifactName }}"
      -metaPackageName "${{ parameters.metaPackageName }}"

# - task: NuGetCommand@2
#   displayName: 'Restore NuGet packages (slnx)'
#   inputs:
#     command: 'restore'
#     feedsToUse: 'config'
#     nugetConfigPath: '$(build.sourcesdirectory)\nuget.config'
#     restoreSolution: '$(build.sourcesdirectory)\**\*.slnx'
#     includeNuGetOrg: false

- task: DotNetCoreCLI@2
  displayName: 'Restore NuGet packages (dotnet)'
  inputs:
    command: 'restore'
    projects: '$(build.sourcesdirectory)\**\*.slnx'
    feedsToUse: 'config'
    nugetConfigPath: '$(build.sourcesdirectory)\nuget.config'
    workingDirectory: '$(build.sourcesdirectory)'
