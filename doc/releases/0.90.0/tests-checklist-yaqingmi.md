## Telemetry Prologue

* Before starting your tests, go to General settings, enable "Diagnostic data" and "Enable viewing" and restart PowerToys.

## Telemetry Epilogue

* After finishing your tests, go to General settings, press Diagnostic data viewer and check if you have xml files for the utilities you've tested and if it looks like the events in those xml files were generated by the actions you did with the utilities you've tested.

## 

## Functional tests

- [x] https://github.com/microsoft/PowerToys/issues/1524

## Localization

 Change the Windows language to a language different than English. Then verify if the following screens change their language:

- [x] System tray menu items
- [x] Settings
- [x] OOBE (What's new)
- [ ] Keyboard Manager Editor
- [x] Color Picker (check the tooltips)
- [ ] FancyZones Editor
- [ ] Power Rename (new WinUI 3 may not be localized)
- [ ] PowerToys Run ("Start typing" string is localized, for example)
- [ ] Image Resizer
- [ ] Shortcut Guide (Windows controls are localized)
- [ ] File Explorer menu entries for Image Resizer, Power Rename and FileLocksmith
- [ ] Hosts File Editor
- [ ] File Locksmith
- [ ] Registry Preview
- [ ] Environment Variables

## General Settings

**Admin mode:**

- [x] restart PT and verify it runs as user
- [x] restart as admin and set "Always run as admin"
- [x] restart PT and verify it  runs as admin
* if it's not on, turn on "Run at startup"
- [x] reboot the machine and verify PT runs as admin (it should not prompt the UAC dialog)
* turn Always run as admin" off
- [x] reboot the machine and verify it now runs as user

**Modules on/off:**

- [x] turn off all the modules and verify all module are off
- [x] restart PT and verify that all module are still off in the settings page and they are actually inactive
- [x] turn on all the module, all module are now working
- [x] restart PT and verify that all module are still on in the settings page and they are actually working

**Quick access tray icon flyout:**

- [x] Use left click on the system tray icon and verify the flyout appears. (It'll take a bit the first time)
- [x] Try to launch a module from the launch screen in the flyout.
- [x] Try disabling a module in the all apps screen in the flyout, make it a module that's launchable from the launch screen. Verify that the module is disabled and that it also disappeared from the launch screen in the flyout.
- [x] Open the main settings screen on a module page. Verify that when you disable/enable the module on the flyout, that the Settings page is updated too.

**Settings backup/restore:**

- [x] In the General tab, create a backup of the settings.
- [x] Change some settings in some PowerToys.
- [x] Restore the settings in the General tab and verify the Settings you've applied were reset.

## Color Picker

* Enable the Color Picker in settings and ensure that the hotkey brings up Color Picker
  - [x] when PowerToys is running unelevated on start-up
  - [x] when PowerToys is running as admin on start-up
  - [x] when PowerToys is restarted as admin, by clicking the restart as admin button in the settings
- [x] Change `Activate Color Picker shortcut` and check the new shortcut is working
- [x] Try all three `Activation behavior`s(`Color Picker with editor mode enabled`, `Editor`, `Color Picker only`)
- [x] Change `Color format for clipboard` and check if the correct format is copied from the Color picker
- [x] Try to copy color formats to the clipboard from the Editor
- [x] Check `Show color name` and verify if color name is shown in the Color picker
- [x] Enable one new format, disable one existing format, reorder enabled formats and check if settings are populated to the Editor
- [x] Select a color from the history in the EditorPowe
- [x] Remove color from the history in the Editor
- [x] Open the Color Picker from the Editor
- [x] Open Adjust color from the Editor
- [x] Check Color Picker logs for errors

## OOBE

* Quit PowerToys
* Delete %localappdata%\Microsoft\PowerToys
- [x] Start PowerToys and verify OOBE opens
* Change version saved on `%localappdata%\Microsoft\PowerToys\last_version.txt`
- [x] Start PowerToys and verify OOBE opens in the "What's New" page
* Visit each OOBE section and for each section:
  - [x] open the Settings for that module
  - [x] verify the Settings work as expected (toggle some controls on/off etc.)
  - [x] close the Settings
  - [x] if it's available, test the `Launch module name` button
* Close OOBE
- [x] Open the Settings and from the General page open OOBE using the `Welcome to PowerToys` link

## Mouse Utils

Find My Mouse:

* Enable FindMyMouse. Then, without moving your mouse:
  - [x] Press Left Ctrl twice and verify the overlay appears.
  - [x] Press any other key and verify the overlay disappears.
  - [x] Press Left Ctrl twice and verify the overlay appears.
  - [x] Press a mouse button and verify the overlay disappears.
* Disable FindMyMouse. Verify the overlay no longer appears when you press Left Ctrl twice.
* Enable FindMyMouse. Then, without moving your mouse:
  - [x] Press Left Ctrl twice and verify the overlay appears.
* Enable the "Do not activate on game mode" option. Start playing a game that uses CG native full screen.
  - [ ] Verify the overlay no longer appears when you press Left Ctrl twice.
* Disable the "Do not activate on game mode" option. Start playing the same game.
  - [ ] Verify the overlay appears when you press Left Ctrl twice. (though it'll likely minimize the game)
* Test the different settings and verify they apply:
  - [x] Overlay opacity
  - [x] Background color
  - [x] Spotlight color
  - [x] Spotlight radius
  - [x] Spotlight initial zoom (1x vs 9x will show the difference)
  - [x] Animation duration
  - [x] Change activation method to shake and activate by shaking your mouse pointer
  - [x] Excluded apps

Mouse Highlighter:

* Enable Mouse Highlighter. Then:
  - [x] Press the activation shortcut and press left and right click somewhere, verifying the hightlights are applied.
  - [x] With left mouse button pressed, drag the mouse and verify the hightlight is dragged with the pointer.
  - [x] With right mouse button pressed, drag the mouse and verify the hightlight is dragged with the pointer.
  - [x] Press the activation shortcut again and verify no highlights appear when the mouse buttons are clicked.
  - [x] Disable Mouse Highlighter and verify that the module is not activated when you press the activation shortcut.
* Test the different settings and verify they apply:
  - [x] Change activation shortcut and test it
  - [x] Left button highlight color
  - [x] Right button highlight color
  - [x] Opacity
  - [x] Radius
  - [x] Fade delay
  - [x] Fade duration

Mouse Pointer Crosshairs:

* Enable Mouse Pointer Crosshairs. Then:
  - [x] Press the activation shortcut and verify the crosshairs appear, and that they follow the mouse around.
  - [x] Press the activation shortcut again and verify the crosshairs disappear.
  - [x] Disable Mouse Pointer Crosshairs and verify that the module is not activated when you press the activation shortcut.
* Test the different settings and verify they apply:
  - [x] Change activation shortcut and test it
  - [x] Crosshairs color
  - [x] Crosshairs opacity
  - [x] Crosshairs center radius
  - [x] Crosshairs thickness
  - [x] Crosshairs border color
  - [x] Crosshairs border size

Mouse Jump:

* Enable Mouse Jump. Then:
  - [x] Press the activation shortcut and verify the screens preview appears.
  - [x] Change activation shortcut and verify that new shorctut triggers Mouse Jump.
  - [x] Click around the screen preview and ensure that mouse cursor jumped to clicked location.
  - [x] Reorder screens in Display settings and confirm that Mouse Jump reflects the change and still works correctly.
  - [x] Change scaling of screens and confirm that Mouse Jump still works correctly.
  - [x] Unplug additional monitors and confirm that Mouse Jump still works correctly.
  - [x] Disable Mouse Jump and verify that the module is not activated when you press the activation shortcut.

## GPO

* Copy the "PowerToys.admx" file to your Policy Definition template folder. (Example: C:\Windows\PolicyDefinitions) and copy the "PowerToys.adml" file to the matching language folder in your Policy Definition folder. (Example: C:\Windows\PolicyDefinitions\en-US)
  - [x] Open the "Local Group Policy Editor" on Windows and verify there is a "Microsoft PowerToys" folder in Administrative Templates for both Computer Configuration and User Configuration.
* In GPO, disable a module that can run as a standalone (FancyZones sounds good for this). Restart PowerToys.
  - [x] Verify the module is not enabled.
  - [x] Open settings and verify the module is not enabled and you can't enable it.
  - [x] Try to open FancyZones Editor directly from the install folder and verify it doesn't run and adds a message to the log saying it didn't run because of GPO.
  - [x] Verify the module can't be launched from the quick launcher system tray flyout launcher screen (FancyZones editor in this case).
  - [x] Verify the module can't be enabled/disabled from the quick launcher system tray flyout.
* In GPO, enable a module that can run as a standalone (FancyZones sounds good for this). Restart PowerToys.
  - [x] Verify the module is enabled.
  - [x] Open settings and verify the module is enabled and you can't disable it.
  - [x] Verify the module can't be enabled/disabled from the quick launcher system tray flyout.
* In GPO, try to set different settings in the Computer and User Configurations for a PowerToy. Restart PowerToys.
  - [x] Verify that the setting in Computer Configuration has priority over the setting in User Configuration.
* In GPO, disable a module that has a context menu entry (File Locksmith sounds good for this). Restart PowerToys.
  - [x] Verify the module is not enabled. (No context menu entry)
  - [x] Open settings and verify the module is not enabled and you can't enable it.
  - [x] Try to open File Locksmith directly from the install folder and verify it doesn't run and adds a message to the log saying it didn't run because of GPO.
* In GPO, disable a module that is a Preview Handler (Markdown Preview is good for this). Restart PowerToys.
  - [x] Verify the module is not enabled. (Markdown files won't appear in the preview pane)
  - [x] Open settings and verify the module is not enabled and you can't enable it.
* Remember to reset all you Settings to Not Configured after the tests, both in Conputer and User Configurations.

## DSC

* You need to have some prerequisites installed:
  - PowerShell >= 7.2 .
  - PSDesiredStateConfiguration 2.0.7 or higher `Install-Module -Name PSDesiredStateConfiguration`.
  - WinGet [version v1.6.2631 or later](https://github.com/microsoft/winget-cli/releases). (You'll likely have this one already)
* Open a PowerShell 7 instance and navigate to the sample scripts from PowerToys (`src/dsc/Microsoft.PowerToys.Configure/examples/`).
  - [x] Run `winget configure .\disableAllModules.dsc.yaml`. Open PowerToys Settings and verify all modules are disabled.
  - [x] Run `winget configure .\enableAllModules.dsc.yaml`. Open PowerToys Settings and verify all modules are enabled.
  - [x] Run `winget configure .\configureLauncherPlugins.dsc.yaml`. Open PowerToys Settings and verify all PowerToys Run plugins are enabled, and the Program plugin is not global and its Activation Keyword has changed to "P:".
  - [x] Run `winget configure .\configuration.dsc.yaml`. Open PowerToys Settings the Settings have been applied. File Locksmith is disabled. Shortcut Guide is disabled with an overlay opacity set to 50. FancyZones is enabled with the Editor hotkey set to "Shift+Ctrl+Alt+F".
  - [x] If you run a winget configure command above and PowerToys is running, it will eventually close and automatically reopen after the configuration process is done.
  - [x] If you run a winget configure command above and PowerToys is not running, it won't automatically reopen after the configuration process is done.

## Advanced Paste

  NOTES:
    When using Advanced Paste, make sure that window focused while starting/using Advanced paste is text editor or has text input field focused (e.g. Word).

* Paste As Plain Text
  - [x] Copy some rich text (e.g word of the text is different color, another work is bold, underlined, etd.).
  - [x] Paste the text using standard Windows Ctrl + V shortcut and ensure that rich text is pasted (with all colors, formatting, etc.)
  - [x] Paste the text using Paste As Plain Text activation shortcut and ensure that plain text without any formatting is pasted.
  - [x] Paste again the text using standard Windows Ctrl + V shortcut and ensure the text is now pasted plain without formatting as well.
  - [x] Copy some rich text again.
  - [x] Open Advanced Paste window using hotkey, click Paste as Plain Text button and confirm that plain text without any formatting is pasted.
  - [x] Copy some rich text again.
  - [x] Open Advanced Paste window using hotkey, press Ctrl + 1 and confirm that plain text without any formatting is pasted.
* Paste As Markdown
  - [x] Open Settings and set Paste as Markdown directly hotkey
  - [x] Copy some text (e.g. some HTML text - convertible to Markdown)
  - [x] Paste the text using set hotkey and confirm that pasted text is converted to markdown
  - [x] Copy some text (same as in the previous step or different. If nothing is coppied between steps, previously pasted Markdown text will be picked up from clipboard and converted again to nested Markdown).
  - [x] Open Advanced Paste window using hotkey, click Paste as markdown button and confirm that pasted text is converted to markdown
  - [x] Copy some text (same as in the previous step or different. If nothing is coppied between steps, previously pasted Markdown text will be picked up from clipboard and converted again to nested Markdown).
  - [x] Open Advanced Paste window using hotkey, press Ctrl + 2 and confirm that pasted text is converted to markdown
* Paste As JSON
  - [x] Open Settings and set Paste as JSON directly hotkey
  - [x] Copy some XML or CSV text (or any other text, it will be converted to simple JSON object)
  - [x] Paste the text using set hotkey and confirm that pasted text is converted to JSON
  - [x] Copy some text (same as in the previous step or different. If nothing is coppied between steps, previously pasted JSON text will be picked up from clipboard and converted again to nested JSON).
  - [x] Open Advanced Paste window using hotkey, click Paste as markdown button and confirm that pasted text is converted to markdown
  - [x] Copy some text (same as in the previous step or different. If nothing is coppied between steps, previously pasted JSON text will be picked up from clipboard and converted again to nested JSON).
  - [x] Open Advanced Paste window using hotkey, press Ctrl + 3 and confirm that pasted text is converted to markdown
* Paste as custom format using AI
  - [x] Open Settings, navigate to Enable Paste with AI and set OpenAI key.
  - [x] Copy some text to clipboard. Any text.
  - [ ] Open Advanced Paste window using hotkey, and confirm that Custom intput text box is now enabled. Write "Insert smiley after every word" and press Enter. Observe that result preview shows coppied text with smileys between words. Press Enter to paste the result and observe that it is pasted.
  - [ ] Open Advanced Paste window using hotkey. Input some query (any, feel free to play around) and press Enter. When result is shown, click regenerate button, to see if new result is generated. Select one of the results and paste. Observe that correct result is pasted.
  - [ ] Create few custom actions. Set up hotkey for custom actions and confirm they work. Enable/disable custom actions and confirm that the change is reflected in Advanced Paste UI - custom action is not listed. Try different ctrl + <num> in-app shortcuts for custom actions. Try moving custom actions up/down and confirm that the change is reflected in Advanced Paste UI.
  - [ ] Open Settings and disable Custom format preview. Open Advanced Paste window with hotkey, enter some query and press enter. Observe that result is now pasted right away, without showing the preview first.
  - [ ] Open Settings and Disable Enable Paste with AI. Open Advanced Paste window with hotkey and observe that Custom Input text box is now disabled.
* Clipboard History
  - [x] Open Settings and Enable clipboard history (if not enabled already). Open Advanced Paste window with hotkey, click Clipboard history and try deleting some entry. Check OS clipboard history (Win+V), and confirm that the same entry no longer exist.
  - [x] Open Advanced Paste window with hotkey, click Clipboard history, and click any entry (but first). Observe that entry is put on top of clipboard history. Check OS clipboard history (Win+V), and confirm that the same entry is on top of the clipboard.
  - [x] Open Settings and Disable clipboard history. Open Advanced Paste window with hotkey and observe that Clipboard history button is disabled.
* Disable Advanced Paste, try different Advanced Paste hotkeys and confirm that it's disabled and nothing happens.
  
  

## New+

* Enable New+ in Settings.
  - [x] Verify NewPlus menu is in Explorer context menu. (Windows 11 tier 1 context menu only. May need Explorer restart.)
* Disable New+ in Settings.
  - [x] Verify NewPlus menu is not in Explorer context menu.
* Choose a different path for template folder.
  - [x] Verify the folder is created and empty.
  - [x] Copy a file to the templates folder, verify it's added to the New+ context menu and that if you select it the file is created.
  - [x] Copy a folder with files inside to the templates folder, verify it's added to the New+ context menu and that if you select it the folder and files inside are created.
  - [x] Delete all files and folders from inside the templates folder. Verify that no templates are available in the context menu.
  - [x] Disable and re-Enable New+ while the templates folder is still empty. Verify the default templates were copied over and are available in the context menu.
* Test some Settings:
  - [x] Test the "Hide template filename extension" option in Settings.
  - [x] Test the "Hide template filename starting digits, spaces and dots" option in Settings.

## ZoomIt

* Enable ZoomIt in Settings.
  - [x] Verify ZoomIt tray icon appears in the tray icons, and that when you left-click or right-click, it just shows the 4 action entries: "Break Timer", "Draw", "Zoom" and "Record".
  - [x] Turn the "Show tray icon" option off and verify the tray icon is gone.
  - [x] Turn the "Show tray icon" option on and verify the tray icon is back.
* Test the base modes through a shortcuts:
  - [x] Press the Zoom Toggle Hotkey and verify ZoomIt zooms in on the mouse. You can exit Zoom by pressing Escape or the Hotkey again.
  - [x] Press the Live Zoom Toggle Hotkey and verify ZoomIt zooms in on the mouse, while the screen still updates instead of showing a still image. You can exit Live Zoom by pressing the Hotkey again.
  - [x] Press the Draw without Zoom Hotkey and verify you can draw. You can leave this mode by pressing the Escape.
  - [x] Select a text file as the Input file for Demo Type, focus notepad and press the Demo Type hotkey. It should start typing the text file. You can exit Demo Type by pressing Escape.
  - [x] Press the Start Break Timer Hotkey and verify it starts the Timer. You can exit by pressing Escape.
  - [x] Press the Record Toggle Hotkey to start recording a screen. Press the Record Toggle Hotkey again to exit the mode and save the recording to a file.
  - [x] Press the Snip Toggle Hotkey to take a snip of the screen. Paste it to Paint to verify a snip was taken.
* Test some Settings to verify the types are being passed correctly to ZoomIt:
  - [x] Change the "Animate zoom in and zoom out" setting and activate Zoom mode to verify it applies.
  - [x] Change the "Specify the initial level of magnification when zooming in" and activate Zoom mode to verify it applies.
  - [x] Change the Type Font to another font. Enter Break mode to quickly verify the font changed.
  - [x] Change the Demo Type typing speed and verify the change applies.
  - [x] Change the timer Opacity for Break mode and verify that the change applies.
  - [x] Change the timer Position for Break mode and verify that the change applies.
  - [x] Select a Background Image file as background for Break mode and verify that the change applies.
  - [x] Turn on "Play Sound on Expiration", select a sound file, aset the timer to 1 minute, activate the Break Mode and verify the sound plays after 1 minute. (Alarm1.wav from "C:\Windows\Media" should be long enough to notice)
  - [x] Open the Microphone combo box in the Record section and verify it lists your microphones.
* Test the tray icon actions:
  - [x] Verify pressing "Break Timer" enters Break mode.
  - [x] Verify pressing "Draw" enters Draw mode.
  - [x] Verify pressing "Zoom" enters Zoom mode.
  - [x] Verify pressing "Record" enters Record mode.

## Command Palette

* Check if Command Palette successfully install/uninstall with PowerToys.
  
  * [x] Install PowerToys. Then check if Command Palette exist in the System Settings/App/Installed Apps.
  * [x] UnInstall PowerToys. Then check if Command Palette doesn't exist in the System Settings/App/Installed Apps.

* Enable Command Palette in settings and ensure that the hotkey brings up Command Palette
  
  * [x] when PowerToys is running unelevated on start-up
  * [x] when PowerToys is running as admin on start-up
  * [x] when PowerToys is restarted as admin, by clicking the restart as admin button in settings.

* Check that each of the plugins is working:
  
  * [x] Installed Apps - launch a Win32 application
  * [x] Installed Apps - launch a Win32 application as admin
  * [x] Installed Apps - launch a packaged application
  * [x] Calculator - ensure a mathematical input returns a correct response and is copied on enter.
  * [x] File Search - open a file on the disk.
  * [x] File Search - find a file and copy file path.
  * [x] File Search - find a file and open containing folder.
  * [x] Run Commands - execute a command. (e.g. `ping google.com`).
  * [x] Windows Walker - Switch to another opening window.
  * [x] Windows Walker - Switch to another opening window when powertoys run as admin.
  * [x] WinGet - Search and install application through WinGet. (eg. `vscode`)
  * [x] Web Search - Search anything by this extension.
  * [x] Windows Terminal Profiles - Open profile.
  * [x] Windows Terminal Profiles - Open profile as Admin.
  * [x] Windows Settings - Open settings from extension.
  * [x] Registry - navigate through the registry tree and open registry editor. Enter the action keyword `:` to get the root keys.
  * [x] Registry - navigate through the registry tree and copy key path.
  * [x] Windows Service - start, stop, restart windows service.
  * [x] Time And Date - type `now`, `year`, `week` and verify the result is correct.
  * [x] Windows System Command - test `lock`.
  * [x] Windows System Command - test `empty recycle bin`.
  * [x] Windows System Command - test `shutdown`.
  * [x] Windows System Command - Click your network adapter item and paste the result at notepad.
  * [x] Bookmarks - Add bookmarks to command palette.
  * [x] Bookmarks - Open your bookmarks (in Command Palette).

* [x] Disable Command Palette and ensure that the hotkey doesn't bring up Command Palette. 

* Test Extensions Manager
  
  * [x] Enable/disable extensions and verify changes are picked up by Command Palette
  * [x] Change `Global hot key` and verify changes are picked up by Command Palette
  * [x] Change `Alias` and verify changes picked up by Command Palette
  * [x] Disable all extensions and verify the warning message is shown (Currently not support).
